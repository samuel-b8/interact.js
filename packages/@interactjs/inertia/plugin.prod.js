Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.InertiaState=void 0;var t=d(require("../modifiers/base.prod.js")),e=f(require("../offset/plugin.prod.js")),i=require("../modifiers/Modification.prod.js"),s=d(require("../utils/domUtils.prod.js")),r=f(require("../utils/hypot.prod.js")),o=f(require("../utils/is.prod.js")),n=require("../utils/pointerUtils.prod.js"),a=f(require("../utils/raf.prod.js"));function f(t){return t&&t.__esModule?t:{default:t}}function c(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(c=t=>t?i:e)(t)}function d(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var i=c(e);if(i&&i.has(t))return i.get(t);var s={__proto__:null},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var n=r?Object.getOwnPropertyDescriptor(t,o):null;n&&(n.get||n.set)?Object.defineProperty(s,o,n):s[o]=t[o]}return s.default=t,i&&i.set(t,s),s}class h{active=!1;isModified=!1;smoothEnd=!1;allowResume=!1;modification;modifierCount=0;modifierArg;startCoords;t0=0;v0=0;te=0;targetOffset;modifiedOffset;currentOffset;lambda_v0=0;one_ve_v0=0;timeout;interaction;constructor(t){this.interaction=t}start(t){const{interaction:e}=this,s=u(e);if(!s||!s.enabled)return!1;const{client:o}=e.coords.velocity,n=(0,r.default)(o.x,o.y),a=this.modification||(this.modification=new i.Modification(e));if(a.copyFrom(e.modification),this.t0=e._now(),this.allowResume=s.allowResume,this.v0=n,this.currentOffset={x:0,y:0},this.startCoords=e.coords.cur.page,this.modifierArg=a.fillArg({pageCoords:this.startCoords,preEnd:!0,phase:"inertiastart"}),this.t0-e.coords.cur.timeStamp<50&&n>s.minSpeed&&n>s.endSpeed)this.startInertia();else{if(a.result=a.setAll(this.modifierArg),!a.result.changed)return!1;this.startSmoothEnd()}return e.modification.result.rect=null,e.offsetBy(this.targetOffset),e._doPhase({interaction:e,event:t,phase:"inertiastart"}),e.offsetBy({x:-this.targetOffset.x,y:-this.targetOffset.y}),e.modification.result.rect=null,this.active=!0,e.simulation=this,!0}startInertia(){const t=this.interaction.coords.velocity.client,e=u(this.interaction),i=e.resistance,s=-Math.log(e.endSpeed/this.v0)/i;this.targetOffset={x:(t.x-s)/i,y:(t.y-s)/i},this.te=s,this.lambda_v0=i/this.v0,this.one_ve_v0=1-e.endSpeed/this.v0;const{modification:r,modifierArg:o}=this;o.pageCoords={x:this.startCoords.x+this.targetOffset.x,y:this.startCoords.y+this.targetOffset.y},r.result=r.setAll(o),r.result.changed&&(this.isModified=!0,this.modifiedOffset={x:this.targetOffset.x+r.result.delta.x,y:this.targetOffset.y+r.result.delta.y}),this.onNextFrame((()=>this.inertiaTick()))}startSmoothEnd(){this.smoothEnd=!0,this.isModified=!0,this.targetOffset={x:this.modification.result.delta.x,y:this.modification.result.delta.y},this.onNextFrame((()=>this.smoothEndTick()))}onNextFrame(t){this.timeout=a.default.request((()=>{this.active&&t()}))}inertiaTick(){const{interaction:t}=this,e=u(t).resistance,i=(t._now()-this.t0)/1e3;if(i<this.te){const f=1-(Math.exp(-e*i)-this.lambda_v0)/this.one_ve_v0;let c;this.isModified?(0,0,s=this.targetOffset.x,r=this.targetOffset.y,o=this.modifiedOffset.x,n=this.modifiedOffset.y,c={x:m(a=f,0,s,o),y:m(a,0,r,n)}):c={x:this.targetOffset.x*f,y:this.targetOffset.y*f};const d={x:c.x-this.currentOffset.x,y:c.y-this.currentOffset.y};this.currentOffset.x+=d.x,this.currentOffset.y+=d.y,t.offsetBy(d),t.move(),this.onNextFrame((()=>this.inertiaTick()))}else t.offsetBy({x:this.modifiedOffset.x-this.currentOffset.x,y:this.modifiedOffset.y-this.currentOffset.y}),this.end();var s,r,o,n,a}smoothEndTick(){const{interaction:t}=this,e=t._now()-this.t0,{smoothEndDuration:i}=u(t);if(e<i){const s={x:p(e,0,this.targetOffset.x,i),y:p(e,0,this.targetOffset.y,i)},r={x:s.x-this.currentOffset.x,y:s.y-this.currentOffset.y};this.currentOffset.x+=r.x,this.currentOffset.y+=r.y,t.offsetBy(r),t.move({skipModifiers:this.modifierCount}),this.onNextFrame((()=>this.smoothEndTick()))}else t.offsetBy({x:this.targetOffset.x-this.currentOffset.x,y:this.targetOffset.y-this.currentOffset.y}),this.end()}resume({pointer:t,event:e,eventTarget:i}){const{interaction:s}=this;s.offsetBy({x:-this.currentOffset.x,y:-this.currentOffset.y}),s.updatePointer(t,e,i,!0),s._doPhase({interaction:s,event:e,phase:"resume"}),(0,n.copyCoords)(s.coords.prev,s.coords.cur),this.stop()}end(){this.interaction.move(),this.interaction.end(),this.stop()}stop(){this.active=this.smoothEnd=!1,this.interaction.simulation=null,a.default.cancel(this.timeout)}}function u({interactable:t,prepared:e}){return t&&t.options&&e.name&&t.options[e.name].inertia}exports.InertiaState=h;const l={id:"inertia",before:["modifiers","actions"],install(i){const{defaults:s}=i;i.usePlugin(e.default),i.usePlugin(t.default),i.actions.phases.inertiastart=!0,i.actions.phases.resume=!0,s.perAction.inertia={enabled:!1,resistance:10,minSpeed:100,endSpeed:10,allowResume:!0,smoothEndDuration:300}},listeners:{"interactions:new"({interaction:t}){t.inertia=new h(t)},"interactions:before-action-end":({interaction:t,event:e})=>(!t._interacting||t.simulation||!t.inertia.start(e))&&null,"interactions:down"(t){const{interaction:e,eventTarget:i}=t,r=e.inertia;if(!r.active)return;let n=i;for(;o.default.element(n);){if(n===e.element){r.resume(t);break}n=s.parentNode(n)}},"interactions:stop"({interaction:t}){const e=t.inertia;e.active&&e.stop()},"interactions:before-action-resume"(t){const{modification:e}=t.interaction;e.stop(t),e.start(t,t.interaction.coords.cur.page),e.applyToInteraction(t)},"interactions:before-action-inertiastart":t=>t.interaction.modification.setAndApply(t),"interactions:action-resume":t.addEventModifiers,"interactions:action-inertiastart":t.addEventModifiers,"interactions:after-action-inertiastart":t=>t.interaction.modification.restoreInteractionCoords(t),"interactions:after-action-resume":t=>t.interaction.modification.restoreInteractionCoords(t)}};function m(t,e,i,s){const r=1-t;return r*r*e+2*r*t*i+t*t*s}function p(t,e,i,s){return-i*(t/=s)*(t-2)+e}exports.default=l;
//# sourceMappingURL=plugin.prod.js.map