Object.defineProperty(exports,"__esModule",{value:!0}),exports.Scope=void 0,exports.initScope=b;var e=w(require("../utils/browser.prod.js")),t=w(require("../utils/clone.prod.js")),i=w(require("../utils/domObjects.prod.js")),s=w(require("../utils/extend.prod.js")),n=w(require("../utils/is.prod.js")),r=w(require("../utils/raf.prod.js")),o=((e,t)=>{if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var i=m(t);if(i&&i.has(e))return i.get(e);var s={__proto__:null},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var o=n?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(s,r,o):s[r]=e[r]}return s.default=e,i&&i.set(e,s),s})(require("../utils/window.prod.js")),a=require("./Eventable"),u=w(require("./events")),l=w(require("./interactions")),d=require("./Interactable"),c=require("./InteractableSet"),p=require("./InteractEvent"),h=require("./InteractStatic"),f=require("./options");function m(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(m=e=>e?i:t)(e)}function w(e){return e&&e.__esModule?e:{default:e}}function b(t,s){return t.isInitialized=!0,n.default.window(s)&&o.init(s),i.default.init(s),e.default.init(s),r.default.init(s),t.window=s,t.document=s.document,t.usePlugin(l.default),t.usePlugin(u.default),t}function g(e){return e&&e.replace(/\/.*$/,"")}exports.Scope=class{id="__interact_scope_"+Math.floor(100*Math.random());isInitialized=!1;listenerMaps=[];browser=e.default;defaults=(0,t.default)(f.defaults);Eventable=a.Eventable;actions={map:{},phases:{start:!0,move:!0,end:!0},methodDict:{},phaselessTypes:{}};interactStatic=(0,h.createInteractStatic)(this);InteractEvent=p.InteractEvent;Interactable;interactables=new c.InteractableSet(this);_win;document;window;documents=[];_plugins={list:[],map:{}};constructor(){const e=this;this.Interactable=class extends d.Interactable{get _defaults(){return e.defaults}set(t){return super.set(t),e.fire("interactable:set",{options:t,interactable:this}),this}unset(){super.unset();const t=e.interactables.list.indexOf(this);t<0||(e.interactables.list.splice(t,1),e.fire("interactable:unset",{interactable:this}))}}}addListeners(e,t){this.listenerMaps.push({id:t,map:e})}fire(e,t){for(const{map:{[e]:i}}of this.listenerMaps)if(i&&!1===i(t,this,e))return!1}onWindowUnload=e=>this.removeDocument(e.target);init(e){return this.isInitialized?this:b(this,e)}pluginIsInstalled(e){const{id:t}=e;return t?!!this._plugins.map[t]:-1!==this._plugins.list.indexOf(e)}usePlugin(e,t){if(!this.isInitialized)return this;if(this.pluginIsInstalled(e))return this;if(e.id&&(this._plugins.map[e.id]=e),this._plugins.list.push(e),e.install&&e.install(this,t),e.listeners&&e.before){let t=0;const i=this.listenerMaps.length,s=e.before.reduce(((e,t)=>(e[t]=!0,e[g(t)]=!0,e)),{});for(;t<i;t++){const e=this.listenerMaps[t].id;if(e&&(s[e]||s[g(e)]))break}this.listenerMaps.splice(t,0,{id:e.id,map:e.listeners})}else e.listeners&&this.listenerMaps.push({id:e.id,map:e.listeners});return this}addDocument(e,t){if(-1!==this.getDocIndex(e))return!1;const i=o.getWindow(e);t=t?(0,s.default)({},t):{},this.documents.push({doc:e,options:t}),this.events.documents.push(e),e!==this.document&&this.events.add(i,"unload",this.onWindowUnload),this.fire("scope:add-document",{doc:e,window:i,scope:this,options:t})}removeDocument(e){const t=this.getDocIndex(e),i=o.getWindow(e),s=this.documents[t].options;this.events.remove(i,"unload",this.onWindowUnload),this.documents.splice(t,1),this.events.documents.splice(t,1),this.fire("scope:remove-document",{doc:e,window:i,scope:this,options:s})}getDocIndex(e){for(let t=0;t<this.documents.length;t++)if(this.documents[t].doc===e)return t;return-1}getDocOptions(e){const t=this.getDocIndex(e);return-1===t?null:this.documents[t].options}now(){return(this.window.Date||Date).now()}};
//# sourceMappingURL=scope.prod.js.map