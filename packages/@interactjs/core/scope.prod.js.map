{
	"version": 3,
	"names": [
		"_browserProd",
		"_interopRequireDefault",
		"require",
		"_cloneProd",
		"_domObjectsProd",
		"_extendProd",
		"_isProd",
		"_rafProd",
		"win",
		"e",
		"r",
		"__esModule",
		"default",
		"t",
		"_getRequireWildcardCache",
		"has",
		"get",
		"n",
		"__proto__",
		"a",
		"Object",
		"defineProperty",
		"getOwnPropertyDescriptor",
		"u",
		"prototype",
		"hasOwnProperty",
		"call",
		"i",
		"set",
		"_interopRequireWildcard",
		"_Eventable",
		"_events",
		"_interactions",
		"_Interactable",
		"_InteractableSet",
		"_InteractEvent",
		"_InteractStatic",
		"_options",
		"WeakMap",
		"obj",
		"initScope",
		"scope",
		"window",
		"isInitialized",
		"is",
		"init",
		"domObjects",
		"browser",
		"raf",
		"document",
		"usePlugin",
		"interactions",
		"events",
		"pluginIdRoot",
		"id",
		"replace",
		"exports",
		"Scope",
		"Math",
		"floor",
		"random",
		"listenerMaps",
		"defaults",
		"clone",
		"Eventable",
		"actions",
		"map",
		"phases",
		"start",
		"move",
		"end",
		"methodDict",
		"phaselessTypes",
		"interactStatic",
		"createInteractStatic",
		"this",
		"InteractEvent",
		"Interactable",
		"interactables",
		"InteractableSet",
		"_win",
		"documents",
		"_plugins",
		"list",
		"constructor",
		"InteractableBase",
		"_defaults",
		"options",
		"super",
		"fire",
		"interactable",
		"unset",
		"index",
		"indexOf",
		"splice",
		"addListeners",
		"push",
		"name",
		"arg",
		"listener",
		"onWindowUnload",
		"event",
		"removeDocument",
		"target",
		"pluginIsInstalled",
		"plugin",
		"install",
		"listeners",
		"before",
		"len",
		"length",
		"reduce",
		"acc",
		"otherId",
		"addDocument",
		"doc",
		"getDocIndex",
		"getWindow",
		"extend",
		"add",
		"remove",
		"getDocOptions",
		"docIndex",
		"now",
		"Date"
	],
	"sources": [
		"scope.ts"
	],
	"sourcesContent": [
		"import browser from '@interactjs/utils/browser'\nimport clone from '@interactjs/utils/clone'\nimport domObjects from '@interactjs/utils/domObjects'\nimport extend from '@interactjs/utils/extend'\nimport is from '@interactjs/utils/is'\nimport raf from '@interactjs/utils/raf'\nimport * as win from '@interactjs/utils/window'\n\nimport type Interaction from '@interactjs/core/Interaction'\n\nimport { Eventable } from './Eventable'\n/* eslint-disable import/no-duplicates -- for typescript module augmentations */\nimport './events'\nimport './interactions'\nimport events from './events'\nimport { Interactable as InteractableBase } from './Interactable'\nimport { InteractableSet } from './InteractableSet'\nimport { InteractEvent } from './InteractEvent'\nimport interactions from './interactions'\n/* eslint-enable import/no-duplicates */\nimport { createInteractStatic } from './InteractStatic'\nimport type { OptionsArg } from './options'\nimport { defaults } from './options'\nimport type { Actions } from './types'\n\nexport interface SignalArgs {\n  'scope:add-document': DocSignalArg\n  'scope:remove-document': DocSignalArg\n  'interactable:unset': { interactable: InteractableBase }\n  'interactable:set': { interactable: InteractableBase; options: OptionsArg }\n  'interactions:destroy': { interaction: Interaction }\n}\n\nexport type ListenerName = keyof SignalArgs\n\nexport type ListenerMap = {\n  [P in ListenerName]?: (arg: SignalArgs[P], scope: Scope, signalName: P) => void | boolean\n}\n\ninterface DocSignalArg {\n  doc: Document\n  window: Window\n  scope: Scope\n  options: Record<string, any>\n}\n\n/** @internal */\nexport interface Plugin {\n  [key: string]: any\n  id?: string\n  listeners?: ListenerMap\n  before?: string[]\n  install?(scope: Scope, options?: any): void\n}\n\n/** @internal */\nexport class Scope {\n  id = `__interact_scope_${Math.floor(Math.random() * 100)}`\n  isInitialized = false\n  listenerMaps: Array<{\n    map: ListenerMap\n    id?: string\n  }> = []\n\n  browser = browser\n  defaults = clone(defaults) as typeof defaults\n  Eventable = Eventable\n  actions: Actions = {\n    map: {},\n    phases: {\n      start: true,\n      move: true,\n      end: true,\n    },\n    methodDict: {} as any,\n    phaselessTypes: {},\n  }\n\n  interactStatic = createInteractStatic(this)\n  InteractEvent = InteractEvent\n  Interactable: typeof InteractableBase\n  interactables = new InteractableSet(this)\n\n  // main window\n  _win!: Window\n\n  // main document\n  document!: Document\n\n  // main window\n  window!: Window\n\n  // all documents being listened to\n  documents: Array<{ doc: Document; options: any }> = []\n\n  _plugins: {\n    list: Plugin[]\n    map: { [id: string]: Plugin }\n  } = {\n    list: [],\n    map: {},\n  }\n\n  constructor() {\n    const scope = this\n\n    this.Interactable = class extends InteractableBase {\n      get _defaults() {\n        return scope.defaults\n      }\n\n      set<T extends InteractableBase>(this: T, options: OptionsArg) {\n        super.set(options)\n\n        scope.fire('interactable:set', {\n          options,\n          interactable: this,\n        })\n\n        return this\n      }\n\n      unset(this: InteractableBase) {\n        super.unset()\n\n        const index = scope.interactables.list.indexOf(this)\n        if (index < 0) return\n\n        scope.interactables.list.splice(index, 1)\n        scope.fire('interactable:unset', { interactable: this })\n      }\n    }\n  }\n\n  addListeners(map: ListenerMap, id?: string) {\n    this.listenerMaps.push({ id, map })\n  }\n\n  fire<T extends ListenerName>(name: T, arg: SignalArgs[T]): void | false {\n    for (const {\n      map: { [name]: listener },\n    } of this.listenerMaps) {\n      if (!!listener && listener(arg as any, this, name as never) === false) {\n        return false\n      }\n    }\n  }\n\n  onWindowUnload = (event: BeforeUnloadEvent) => this.removeDocument(event.target as Document)\n\n  init(window: Window | typeof globalThis) {\n    return this.isInitialized ? this : initScope(this, window)\n  }\n\n  pluginIsInstalled(plugin: Plugin) {\n    const { id } = plugin\n    return id ? !!this._plugins.map[id] : this._plugins.list.indexOf(plugin) !== -1\n  }\n\n  usePlugin(plugin: Plugin, options?: { [key: string]: any }) {\n    if (!this.isInitialized) {\n      return this\n    }\n\n    if (this.pluginIsInstalled(plugin)) {\n      return this\n    }\n\n    if (plugin.id) {\n      this._plugins.map[plugin.id] = plugin\n    }\n    this._plugins.list.push(plugin)\n\n    if (plugin.install) {\n      plugin.install(this, options)\n    }\n\n    if (plugin.listeners && plugin.before) {\n      let index = 0\n      const len = this.listenerMaps.length\n      const before = plugin.before.reduce((acc, id) => {\n        acc[id] = true\n        acc[pluginIdRoot(id)] = true\n        return acc\n      }, {})\n\n      for (; index < len; index++) {\n        const otherId = this.listenerMaps[index].id\n\n        if (otherId && (before[otherId] || before[pluginIdRoot(otherId)])) {\n          break\n        }\n      }\n\n      this.listenerMaps.splice(index, 0, { id: plugin.id, map: plugin.listeners })\n    } else if (plugin.listeners) {\n      this.listenerMaps.push({ id: plugin.id, map: plugin.listeners })\n    }\n\n    return this\n  }\n\n  addDocument(doc: Document, options?: any): void | false {\n    // do nothing if document is already known\n    if (this.getDocIndex(doc) !== -1) {\n      return false\n    }\n\n    const window = win.getWindow(doc)\n\n    options = options ? extend({}, options) : {}\n\n    this.documents.push({ doc, options })\n    this.events.documents.push(doc)\n\n    // don't add an unload event for the main document\n    // so that the page may be cached in browser history\n    if (doc !== this.document) {\n      this.events.add(window, 'unload', this.onWindowUnload)\n    }\n\n    this.fire('scope:add-document', { doc, window, scope: this, options })\n  }\n\n  removeDocument(doc: Document) {\n    const index = this.getDocIndex(doc)\n\n    const window = win.getWindow(doc)\n    const options = this.documents[index].options\n\n    this.events.remove(window, 'unload', this.onWindowUnload)\n\n    this.documents.splice(index, 1)\n    this.events.documents.splice(index, 1)\n\n    this.fire('scope:remove-document', { doc, window, scope: this, options })\n  }\n\n  getDocIndex(doc: Document) {\n    for (let i = 0; i < this.documents.length; i++) {\n      if (this.documents[i].doc === doc) {\n        return i\n      }\n    }\n\n    return -1\n  }\n\n  getDocOptions(doc: Document) {\n    const docIndex = this.getDocIndex(doc)\n\n    return docIndex === -1 ? null : this.documents[docIndex].options\n  }\n\n  now() {\n    return (((this.window as any).Date as typeof Date) || Date).now()\n  }\n}\n\n/** @internal */\nexport function initScope(scope: Scope, window: Window | typeof globalThis) {\n  scope.isInitialized = true\n\n  if (is.window(window)) {\n    win.init(window)\n  }\n\n  domObjects.init(window)\n  browser.init(window)\n  raf.init(window)\n\n  // @ts-expect-error\n  scope.window = window\n  scope.document = window.document\n\n  scope.usePlugin(interactions)\n  scope.usePlugin(events)\n\n  return scope\n}\n\nfunction pluginIdRoot(id: string) {\n  return id && id.replace(/\\/.*$/, '')\n}\n"
	],
	"mappings": "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"
}