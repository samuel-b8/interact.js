import*as e from"../utils/arr.prod.js";import*as t from"../utils/domUtils.prod.js";import n from"../utils/is.prod.js";import s from"../utils/pointerExtend.prod.js";import*as o from"../utils/pointerUtils.prod.js";class r{currentTarget;originalEvent;type;constructor(e){this.originalEvent=e,s(this,e)}preventOriginalDefault(){this.originalEvent.preventDefault()}stopPropagation(){this.originalEvent.stopPropagation()}stopImmediatePropagation(){this.originalEvent.stopImmediatePropagation()}}function i(e){return n.object(e)?{capture:!!e.capture,passive:!!e.passive}:{capture:!!e,passive:!1}}function a(e,t){return e===t||("boolean"==typeof e?!!t.capture===e&&0==!!t.passive:!!e.capture==!!t.capture&&!!e.passive==!!t.passive)}export default{id:"events",install(s){var p;const l=[],c={},u=[],f={add:v,remove:d,addDelegate(t,n,s,o,r){const a=i(r);if(!c[s]){c[s]=[];for(const e of u)v(e,s,g),v(e,s,m,!0)}const p=c[s];let l=e.find(p,(e=>e.selector===t&&e.context===n));l||(l={selector:t,context:n,listeners:[]},p.push(l)),l.listeners.push({func:o,options:a})},removeDelegate(e,t,n,s,o){const r=i(o),p=c[n];let l,u=!1;if(p)for(l=p.length-1;l>=0;l--){const o=p[l];if(o.selector===e&&o.context===t){const{listeners:e}=o;for(let o=e.length-1;o>=0;o--){const i=e[o];if(i.func===s&&a(i.options,r)){e.splice(o,1),e.length||(p.splice(l,1),d(t,n,g),d(t,n,m,!0)),u=!0;break}}if(u)break}}},delegateListener:g,delegateUseCapture:m,delegatedEvents:c,documents:u,targets:l,supportsOptions:!1,supportsPassive:!1};function v(t,n,s,o){if(!t.addEventListener)return;const r=i(o);let p=e.find(l,(e=>e.eventTarget===t));p||(p={eventTarget:t,events:{}},l.push(p)),p.events[n]||(p.events[n]=[]),e.find(p.events[n],(e=>e.func===s&&a(e.options,r)))||(t.addEventListener(n,s,f.supportsOptions?r:r.capture),p.events[n].push({func:s,options:r}))}function d(t,n,s,o){if(!t.addEventListener||!t.removeEventListener)return;const r=e.findIndex(l,(e=>e.eventTarget===t)),p=l[r];if(!p||!p.events)return;if("all"===n){for(n in p.events)p.events.hasOwnProperty(n)&&d(t,n,"all");return}let c=!1;const u=p.events[n];if(u){if("all"===s){for(let e=u.length-1;e>=0;e--){const s=u[e];d(t,n,s.func,s.options)}return}{const e=i(o);for(let o=0;o<u.length;o++){const r=u[o];if(r.func===s&&a(r.options,e)){t.removeEventListener(n,s,f.supportsOptions?e:e.capture),u.splice(o,1),0===u.length&&(delete p.events[n],c=!0);break}}}}c&&!Object.keys(p.events).length&&l.splice(r,1)}function g(e,s){const p=i(s),l=new r(e),u=c[e.type],[f]=o.getEventTargets(e);let v=f;for(;n.element(v);){for(let e=0;e<u.length;e++){const n=u[e],{selector:s,context:o}=n;if(t.matchesSelector(v,s)&&t.nodeContains(o,f)&&t.nodeContains(o,v)){const{listeners:e}=n;l.currentTarget=v;for(const t of e)a(t.options,p)&&t.func(l)}}v=t.parentNode(v)}}function m(e){return g(e,!0)}return null==(p=s.document)||p.createElement("div").addEventListener("test",null,{get capture(){return f.supportsOptions=!0},get passive(){return f.supportsPassive=!0}}),s.events=f,f}};
//# sourceMappingURL=events.prod.js.map