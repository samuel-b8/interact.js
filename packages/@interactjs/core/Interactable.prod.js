import*as t from"../utils/arr.prod.js";import e from"../utils/browser.prod.js";import s from"../utils/clone.prod.js";import{getElementRect as n,matchesUpTo as o,nodeContains as i,trySelector as r}from"../utils/domUtils.prod.js";import c from"../utils/extend.prod.js";import h from"../utils/is.prod.js";import l from"../utils/isNonNativeEvent.prod.js";import a from"../utils/normalizeListeners.prod.js";import{getWindow as f}from"../utils/window.prod.js";import{Eventable as p}from"./Eventable";var u=(t=>(t[t.On=0]="On",t[t.Off=1]="Off",t))(u||{});export class Interactable{get _defaults(){return{base:{},perAction:{},actions:{}}}target;options;_actions;events=new p;_context;_win;_doc;_scopeEvents;constructor(t,e,s,n){this._actions=e.actions,this.target=t,this._context=e.context||s,this._win=f(r(t)?this._context:t),this._doc=this._win.document,this._scopeEvents=n,this.set(e)}setOnEvents(t,e){return h.func(e.onstart)&&this.on(t+"start",e.onstart),h.func(e.onmove)&&this.on(t+"move",e.onmove),h.func(e.onend)&&this.on(t+"end",e.onend),h.func(e.oninertiastart)&&this.on(t+"inertiastart",e.oninertiastart),this}updatePerActionListeners(t,e,s){var n;const o=null==(n=this._actions.map[t])?void 0:n.filterEventType,i=t=>(null==o||o(t))&&l(t,this._actions);(h.array(e)||h.object(e))&&this._onOff(u.Off,t,e,void 0,i),(h.array(s)||h.object(s))&&this._onOff(u.On,t,s,void 0,i)}setPerAction(e,n){const o=this._defaults;for(const i in n){const r=i,l=this.options[e],a=n[r];"listeners"===r&&this.updatePerActionListeners(e,l.listeners,a),h.array(a)?l[r]=t.from(a):h.plainObject(a)?(l[r]=c(l[r]||{},s(a)),h.object(o.perAction[r])&&"enabled"in o.perAction[r]&&(l[r].enabled=!1!==a.enabled)):h.bool(a)&&h.object(o.perAction[r])?l[r].enabled=a:l[r]=a}}getRect(t){return t=t||(h.element(this.target)?this.target:null),h.string(this.target)&&(t=t||this._context.querySelector(this.target)),n(t)}rectChecker(t){return h.func(t)?(this.getRect=e=>{const s=c({},t.apply(this,e));return"width"in s||(s.width=s.right-s.left,s.height=s.bottom-s.top),s},this):null===t?(delete this.getRect,this):this.getRect}_backCompatOption(t,e){if(r(e)||h.object(e)){this.options[t]=e;for(const s in this._actions.map)this.options[s][t]=e;return this}return this.options[t]}origin(t){return this._backCompatOption("origin",t)}deltaSource(t){return"page"===t||"client"===t?(this.options.deltaSource=t,this):this.options.deltaSource}getAllElements(){const{target:t}=this;return h.string(t)?Array.from(this._context.querySelectorAll(t)):h.func(t)&&t.getAllElements?t.getAllElements():h.element(t)?[t]:[]}context(){return this._context}inContext(t){return this._context===t.ownerDocument||i(this._context,t)}testIgnoreAllow(t,e,s){return!this.testIgnore(t.ignoreFrom,e,s)&&this.testAllow(t.allowFrom,e,s)}testAllow(t,e,s){return!t||!!h.element(s)&&(h.string(t)?o(s,t,e):!!h.element(t)&&i(t,s))}testIgnore(t,e,s){return!(!t||!h.element(s))&&(h.string(t)?o(s,t,e):!!h.element(t)&&i(t,s))}fire(t){return this.events.fire(t),this}_onOff(t,s,n,o,i){h.object(s)&&!h.array(s)&&(o=n,n=null);const r=a(s,n,i);for(let s in r){"wheel"===s&&(s=e.wheelEvent);for(const e of r[s])l(s,this._actions)?this.events[t===u.On?"on":"off"](s,e):h.string(this.target)?this._scopeEvents[t===u.On?"addDelegate":"removeDelegate"](this.target,this._context,s,e,o):this._scopeEvents[t===u.On?"add":"remove"](this.target,s,e,o)}return this}on(t,e,s){return this._onOff(u.On,t,e,s)}off(t,e,s){return this._onOff(u.Off,t,e,s)}set(t){const e=this._defaults;h.object(t)||(t={}),this.options=s(e.base);for(const s in this._actions.methodDict){const n=s,o=this._actions.methodDict[n];this.options[n]={},this.setPerAction(n,c(c({},e.perAction),e.actions[n])),this[o](t[n])}for(const e in t)"getRect"!==e?h.func(this[e])&&this[e](t[e]):this.rectChecker(t.getRect);return this}unset(){if(h.string(this.target))for(const t in this._scopeEvents.delegatedEvents){const e=this._scopeEvents.delegatedEvents[t];for(let s=e.length-1;s>=0;s--){const{selector:n,context:o,listeners:i}=e[s];n===this.target&&o===this._context&&e.splice(s,1);for(let e=i.length-1;e>=0;e--)this._scopeEvents.removeDelegate(this.target,this._context,t,i[e][0],i[e][1])}}else this._scopeEvents.remove(this.target,"all")}}
//# sourceMappingURL=Interactable.prod.js.map