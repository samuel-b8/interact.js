Object.defineProperty(exports,"__esModule",{value:!0}),exports.Interactable=void 0;var t=((t,e)=>{if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var n=f(e);if(n&&n.has(t))return n.get(t);var s={__proto__:null},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var i=r?Object.getOwnPropertyDescriptor(t,o):null;i&&(i.get||i.set)?Object.defineProperty(s,o,i):s[o]=t[o]}return s.default=t,n&&n.set(t,s),s})(require("../utils/arr.prod.js")),e=c(require("../utils/browser.prod.js")),n=c(require("../utils/clone.prod.js")),s=require("../utils/domUtils.prod.js"),r=c(require("../utils/extend.prod.js")),o=c(require("../utils/is.prod.js")),i=c(require("../utils/isNonNativeEvent.prod.js")),a=c(require("../utils/normalizeListeners.prod.js")),l=require("../utils/window.prod.js"),u=require("./Eventable");function c(t){return t&&t.__esModule?t:{default:t}}function f(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(f=t=>t?n:e)(t)}var d=(t=>(t[t.On=0]="On",t[t.Off=1]="Off",t))(d||{});exports.Interactable=class{get _defaults(){return{base:{},perAction:{},actions:{}}}target;options;_actions;events=new u.Eventable;_context;_win;_doc;_scopeEvents;constructor(t,e,n,r){this._actions=e.actions,this.target=t,this._context=e.context||n,this._win=(0,l.getWindow)((0,s.trySelector)(t)?this._context:t),this._doc=this._win.document,this._scopeEvents=r,this.set(e)}setOnEvents(t,e){return o.default.func(e.onstart)&&this.on(t+"start",e.onstart),o.default.func(e.onmove)&&this.on(t+"move",e.onmove),o.default.func(e.onend)&&this.on(t+"end",e.onend),o.default.func(e.oninertiastart)&&this.on(t+"inertiastart",e.oninertiastart),this}updatePerActionListeners(t,e,n){var s;const r=null==(s=this._actions.map[t])?void 0:s.filterEventType,a=t=>(null==r||r(t))&&(0,i.default)(t,this._actions);(o.default.array(e)||o.default.object(e))&&this._onOff(d.Off,t,e,void 0,a),(o.default.array(n)||o.default.object(n))&&this._onOff(d.On,t,n,void 0,a)}setPerAction(e,s){const i=this._defaults;for(const a in s){const l=a,u=this.options[e],c=s[l];"listeners"===l&&this.updatePerActionListeners(e,u.listeners,c),o.default.array(c)?u[l]=t.from(c):o.default.plainObject(c)?(u[l]=(0,r.default)(u[l]||{},(0,n.default)(c)),o.default.object(i.perAction[l])&&"enabled"in i.perAction[l]&&(u[l].enabled=!1!==c.enabled)):o.default.bool(c)&&o.default.object(i.perAction[l])?u[l].enabled=c:u[l]=c}}getRect(t){return t=t||(o.default.element(this.target)?this.target:null),o.default.string(this.target)&&(t=t||this._context.querySelector(this.target)),(0,s.getElementRect)(t)}rectChecker(t){return o.default.func(t)?(this.getRect=e=>{const n=(0,r.default)({},t.apply(this,e));return"width"in n||(n.width=n.right-n.left,n.height=n.bottom-n.top),n},this):null===t?(delete this.getRect,this):this.getRect}_backCompatOption(t,e){if((0,s.trySelector)(e)||o.default.object(e)){this.options[t]=e;for(const n in this._actions.map)this.options[n][t]=e;return this}return this.options[t]}origin(t){return this._backCompatOption("origin",t)}deltaSource(t){return"page"===t||"client"===t?(this.options.deltaSource=t,this):this.options.deltaSource}getAllElements(){const{target:t}=this;return o.default.string(t)?Array.from(this._context.querySelectorAll(t)):o.default.func(t)&&t.getAllElements?t.getAllElements():o.default.element(t)?[t]:[]}context(){return this._context}inContext(t){return this._context===t.ownerDocument||(0,s.nodeContains)(this._context,t)}testIgnoreAllow(t,e,n){return!this.testIgnore(t.ignoreFrom,e,n)&&this.testAllow(t.allowFrom,e,n)}testAllow(t,e,n){return!t||!!o.default.element(n)&&(o.default.string(t)?(0,s.matchesUpTo)(n,t,e):!!o.default.element(t)&&(0,s.nodeContains)(t,n))}testIgnore(t,e,n){return!(!t||!o.default.element(n))&&(o.default.string(t)?(0,s.matchesUpTo)(n,t,e):!!o.default.element(t)&&(0,s.nodeContains)(t,n))}fire(t){return this.events.fire(t),this}_onOff(t,n,s,r,l){o.default.object(n)&&!o.default.array(n)&&(r=s,s=null);const u=(0,a.default)(n,s,l);for(let n in u){"wheel"===n&&(n=e.default.wheelEvent);for(const e of u[n])(0,i.default)(n,this._actions)?this.events[t===d.On?"on":"off"](n,e):o.default.string(this.target)?this._scopeEvents[t===d.On?"addDelegate":"removeDelegate"](this.target,this._context,n,e,r):this._scopeEvents[t===d.On?"add":"remove"](this.target,n,e,r)}return this}on(t,e,n){return this._onOff(d.On,t,e,n)}off(t,e,n){return this._onOff(d.Off,t,e,n)}set(t){const e=this._defaults;o.default.object(t)||(t={}),this.options=(0,n.default)(e.base);for(const n in this._actions.methodDict){const s=n,o=this._actions.methodDict[s];this.options[s]={},this.setPerAction(s,(0,r.default)((0,r.default)({},e.perAction),e.actions[s])),this[o](t[s])}for(const e in t)"getRect"!==e?o.default.func(this[e])&&this[e](t[e]):this.rectChecker(t.getRect);return this}unset(){if(o.default.string(this.target))for(const t in this._scopeEvents.delegatedEvents){const e=this._scopeEvents.delegatedEvents[t];for(let n=e.length-1;n>=0;n--){const{selector:s,context:r,listeners:o}=e[n];s===this.target&&r===this._context&&e.splice(n,1);for(let e=o.length-1;e>=0;e--)this._scopeEvents.removeDelegate(this.target,this._context,t,o[e][0],o[e][1])}}else this._scopeEvents.remove(this.target,"all")}};
//# sourceMappingURL=Interactable.prod.js.map