Object.defineProperty(exports,"__esModule",{value:!0}),exports.Modification=void 0,exports.getRectOffset=a;var t=o(require("../utils/clone.prod.js")),e=o(require("../utils/extend.prod.js")),s=((t,e)=>{if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var s=r(e);if(s&&s.has(t))return s.get(t);var o={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in t)if("default"!==a&&Object.prototype.hasOwnProperty.call(t,a)){var n=i?Object.getOwnPropertyDescriptor(t,a):null;n&&(n.get||n.set)?Object.defineProperty(o,a,n):o[a]=t[a]}return o.default=t,s&&s.set(t,o),o})(require("../utils/rect.prod.js"));function r(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,s=new WeakMap;return(r=t=>t?s:e)(t)}function o(t){return t&&t.__esModule?t:{default:t}}function i(t,e){return{rect:e,coords:t,delta:{x:0,y:0},rectDelta:{left:0,right:0,top:0,bottom:0},eventProps:[],changed:!0}}function a(t,e){return t?{left:e.x-t.left,top:e.y-t.top,right:t.right-e.x,bottom:t.bottom-e.y}:{left:0,top:0,right:0,bottom:0}}exports.Modification=class{states=[];startOffset={left:0,right:0,top:0,bottom:0};startDelta;result;endResult;startEdges;edges;interaction;constructor(t){this.interaction=t,this.result=i(),this.edges={left:!1,right:!1,top:!1,bottom:!1}}start({phase:t},s){const{interaction:r}=this,o=(t=>{const e=t.interactable.options[t.prepared.name],s=e.modifiers;return s&&s.length?s:["snap","snapSize","snapEdges","restrict","restrictEdges","restrictSize"].map((t=>{const s=e[t];return s&&s.enabled&&{options:s,methods:s._methods}})).filter((t=>!!t))})(r);this.prepareStates(o),this.startEdges=(0,e.default)({},r.edges),this.edges=(0,e.default)({},this.startEdges),this.startOffset=a(r.rect,s),this.startDelta={x:0,y:0};const n=this.fillArg({phase:t,pageCoords:s,preEnd:!1});return this.result=i(),this.startAll(n),this.result=this.setAll(n)}fillArg(t){const{interaction:e}=this;return t.interaction=e,t.interactable=e.interactable,t.element=e.element,t.rect||(t.rect=e.rect),t.edges||(t.edges=this.startEdges),t.startOffset=this.startOffset,t}startAll(t){for(const e of this.states)e.methods.start&&(t.state=e,e.methods.start(t))}setAll(t){const{phase:r,preEnd:o,skipModifiers:a,rect:n,edges:l}=t;t.coords=(0,e.default)({},t.pageCoords),t.rect=(0,e.default)({},n),t.edges=(0,e.default)({},l);const d=a?this.states.slice(a):this.states,c=i(t.coords,t.rect);for(const i of d){var h;const{options:a}=i,n=(0,e.default)({},t.coords);let l=null;null!=(h=i.methods)&&h.set&&this.shouldDo(a,o,r)&&(t.state=i,l=i.methods.set(t),s.addEdges(t.edges,t.rect,{x:t.coords.x-n.x,y:t.coords.y-n.y})),c.eventProps.push(l)}(0,e.default)(this.edges,t.edges),c.delta.x=t.coords.x-t.pageCoords.x,c.delta.y=t.coords.y-t.pageCoords.y,c.rectDelta.left=t.rect.left-n.left,c.rectDelta.right=t.rect.right-n.right,c.rectDelta.top=t.rect.top-n.top,c.rectDelta.bottom=t.rect.bottom-n.bottom;const f=this.result.coords,p=this.result.rect;if(f&&p){const t=c.rect.left!==p.left||c.rect.right!==p.right||c.rect.top!==p.top||c.rect.bottom!==p.bottom;c.changed=t||f.x!==c.coords.x||f.y!==c.coords.y}return c}applyToInteraction(t){const{interaction:s}=this,{phase:r}=t,o=s.coords.cur,i=s.coords.start,{result:a,startDelta:n}=this,l=a.delta;"start"===r&&(0,e.default)(this.startDelta,a.delta);for(const[t,e]of[[i,n],[o,l]])t.page.x+=e.x,t.page.y+=e.y,t.client.x+=e.x,t.client.y+=e.y;const{rectDelta:d}=this.result,c=t.rect||s.rect;c.left+=d.left,c.right+=d.right,c.top+=d.top,c.bottom+=d.bottom,c.width=c.right-c.left,c.height=c.bottom-c.top}setAndApply(t){const{interaction:e}=this,{phase:s,preEnd:r,skipModifiers:o}=t,i=this.setAll(this.fillArg({preEnd:r,phase:s,pageCoords:t.modifiedCoords||e.coords.cur.page}));if(this.result=i,!i.changed&&(!o||o<this.states.length)&&e.interacting())return!1;if(t.modifiedCoords){const{page:s}=e.coords.cur,r={x:t.modifiedCoords.x-s.x,y:t.modifiedCoords.y-s.y};i.coords.x+=r.x,i.coords.y+=r.y,i.delta.x+=r.x,i.delta.y+=r.y}this.applyToInteraction(t)}beforeEnd(t){const{interaction:e,event:s}=t,r=this.states;if(!r||!r.length)return;let o=!1;for(const e of r){t.state=e;const{options:s,methods:r}=e,i=r.beforeEnd&&r.beforeEnd(t);if(i)return this.endResult=i,!1;o=o||!o&&this.shouldDo(s,!0,t.phase,!0)}o&&e.move({event:s,preEnd:!0})}stop(t){const{interaction:s}=t;if(!this.states||!this.states.length)return;const r=(0,e.default)({states:this.states,interactable:s.interactable,element:s.element,rect:null},t);this.fillArg(r);for(const t of this.states)r.state=t,t.methods.stop&&t.methods.stop(r);this.states=null,this.endResult=null}prepareStates(t){this.states=[];for(let e=0;e<t.length;e++){const{options:s,methods:r,name:o}=t[e];this.states.push({options:s,methods:r,index:e,name:o})}return this.states}restoreInteractionCoords({interaction:{coords:t,rect:e,modification:s}}){if(!s.result)return;const{startDelta:r}=s,{delta:o,rectDelta:i}=s.result,a=[[t.start,r],[t.cur,o]];for(const[t,e]of a)t.page.x-=e.x,t.page.y-=e.y,t.client.x-=e.x,t.client.y-=e.y;e.left-=i.left,e.right-=i.right,e.top-=i.top,e.bottom-=i.bottom}shouldDo(t,e,s,r){return!(!t||!1===t.enabled||r&&!t.endOnly||t.endOnly&&!e||"start"===s&&!t.setStart)}copyFrom(s){this.startOffset=s.startOffset,this.startDelta=s.startDelta,this.startEdges=s.startEdges,this.edges=s.edges,this.states=s.states.map((e=>(0,t.default)(e))),this.result=i((0,e.default)({},s.result.coords),(0,e.default)({},s.result.rect))}destroy(){for(const t in this)this[t]=null}};
//# sourceMappingURL=Modification.prod.js.map