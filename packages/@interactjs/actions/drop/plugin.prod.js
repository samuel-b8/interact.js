Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=l(require("../../utils/domUtils.prod.js")),t=i(require("../../utils/extend.prod.js")),r=i(require("../../utils/getOriginXY.prod.js")),o=i(require("../../utils/is.prod.js")),n=i(require("../../utils/normalizeListeners.prod.js")),a=l(require("../../utils/pointerUtils.prod.js")),p=i(require("../drag/plugin")),d=require("./DropEvent");function i(e){return e&&e.__esModule?e:{default:e}}function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(c=e=>e?r:t)(e)}function l(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=c(t);if(r&&r.has(e))return r.get(e);var o={__proto__:null},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var p=n?Object.getOwnPropertyDescriptor(e,a):null;p&&(p.get||p.set)?Object.defineProperty(o,a,p):o[a]=e[a]}return o.default=e,r&&r.set(e,o),o}function s(e,t){for(const{dropzone:r,element:o}of e.slice())t.dropzone=r,t.target=o,r.fire(t),t.propagationStopped=t.immediatePropagationStopped=!1}function u(t,r){const n=(({interactables:t},r)=>{const n=[];for(const a of t.list){if(!a.options.drop.enabled)continue;const t=a.options.drop.accept;if(!(o.default.element(t)&&t!==r||o.default.string(t)&&!e.matchesSelector(r,t)||o.default.func(t)&&!t({dropzone:a,draggableElement:r})))for(const e of a.getAllElements())e!==r&&n.push({dropzone:a,element:e,rect:a.getRect(e)})}return n})(t,r);for(const e of n)e.rect=e.dropzone.getRect(e.element);return n}function v({dropState:t,interactable:r,element:o},n,a){const p=[];for(const{dropzone:e,element:d,rect:i}of t.activeDrops){const t=e.dropCheck(n,a,r,o,d,i);p.push(t?d:null)}const d=e.indexOfDeepestElement(p);return t.activeDrops[d]||null}function f(e,t,r){const o=e.dropState,n={enter:null,leave:null,activate:null,deactivate:null,move:null,drop:null};return"dragstart"===r.type&&(n.activate=new d.DropEvent(o,r,"dropactivate"),n.activate.target=null,n.activate.dropzone=null),"dragend"===r.type&&(n.deactivate=new d.DropEvent(o,r,"dropdeactivate"),n.deactivate.target=null,n.deactivate.dropzone=null),o.rejected||(o.cur.element!==o.prev.element&&(o.prev.dropzone&&(n.leave=new d.DropEvent(o,r,"dragleave"),r.dragLeave=n.leave.target=o.prev.element,r.prevDropzone=n.leave.dropzone=o.prev.dropzone),o.cur.dropzone&&(n.enter=new d.DropEvent(o,r,"dragenter"),r.dragEnter=o.cur.element,r.dropzone=o.cur.dropzone)),"dragend"===r.type&&o.cur.dropzone&&(n.drop=new d.DropEvent(o,r,"drop"),r.dropzone=o.cur.dropzone,r.relatedTarget=o.cur.element),"dragmove"===r.type&&o.cur.dropzone&&(n.move=new d.DropEvent(o,r,"dropmove"),r.dropzone=o.cur.dropzone)),n}function m(e,t){const r=e.dropState,{activeDrops:o,cur:n,prev:a}=r;t.leave&&a.dropzone.fire(t.leave),t.enter&&n.dropzone.fire(t.enter),t.move&&n.dropzone.fire(t.move),t.drop&&n.dropzone.fire(t.drop),t.deactivate&&s(o,t.deactivate),r.prev.dropzone=n.dropzone,r.prev.element=n.element}function g({interaction:e,iEvent:t,event:r},o){if("dragmove"!==t.type&&"dragend"!==t.type)return;const n=e.dropState;o.dynamicDrop&&(n.activeDrops=u(o,e.element));const a=t,p=v(e,a,r);n.rejected=n.rejected&&!!p&&p.dropzone===n.cur.dropzone&&p.element===n.cur.element,n.cur.dropzone=p&&p.dropzone,n.cur.element=p&&p.element,n.events=f(e,0,a)}const h={id:"actions/drop",install(e){const{actions:d,interactStatic:i,Interactable:c,defaults:l}=e;e.usePlugin(p.default),c.prototype.dropzone=function(e){return((e,t)=>{if(o.default.object(t)){if(e.options.drop.enabled=!1!==t.enabled,t.listeners){const r=(0,n.default)(t.listeners),o=Object.keys(r).reduce(((e,t)=>(e[/^(enter|leave)/.test(t)?"drag"+t:/^(activate|deactivate|move)/.test(t)?"drop"+t:t]=r[t],e)),{}),a=e.options.drop.listeners;a&&e.off(a),e.on(o),e.options.drop.listeners=o}return o.default.func(t.ondrop)&&e.on("drop",t.ondrop),o.default.func(t.ondropactivate)&&e.on("dropactivate",t.ondropactivate),o.default.func(t.ondropdeactivate)&&e.on("dropdeactivate",t.ondropdeactivate),o.default.func(t.ondragenter)&&e.on("dragenter",t.ondragenter),o.default.func(t.ondragleave)&&e.on("dragleave",t.ondragleave),o.default.func(t.ondropmove)&&e.on("dropmove",t.ondropmove),/^(pointer|center)$/.test(t.overlap)?e.options.drop.overlap=t.overlap:o.default.number(t.overlap)&&(e.options.drop.overlap=Math.max(Math.min(1,t.overlap),0)),"accept"in t&&(e.options.drop.accept=t.accept),"checker"in t&&(e.options.drop.checker=t.checker),e}return o.default.bool(t)?(e.options.drop.enabled=t,e):e.options.drop})(this,e)},c.prototype.dropCheck=function(e,t,n,p,d,i){return((e,t,n,p,d,i,c)=>{let l=!1;if(!(c=c||e.getRect(i)))return!!e.options.drop.checker&&e.options.drop.checker(t,n,l,e,i,p,d);const s=e.options.drop.overlap;if("pointer"===s){const e=(0,r.default)(p,d,"drag"),o=a.getPageXY(t);o.x+=e.x,o.y+=e.y;const n=o.x>c.left&&o.x<c.right,i=o.y>c.top&&o.y<c.bottom;l=n&&i}const u=p.getRect(d);if(u&&"center"===s){const e=u.left+u.width/2,t=u.top+u.height/2;l=e>=c.left&&e<=c.right&&t>=c.top&&t<=c.bottom}return u&&o.default.number(s)&&(l=Math.max(0,Math.min(c.right,u.right)-Math.max(c.left,u.left))*Math.max(0,Math.min(c.bottom,u.bottom)-Math.max(c.top,u.top))/(u.width*u.height)>=s),e.options.drop.checker&&(l=e.options.drop.checker(t,n,l,e,i,p,d)),l})(this,e,t,n,p,d,i)},i.dynamicDrop=t=>o.default.bool(t)?(e.dynamicDrop=t,i):e.dynamicDrop,(0,t.default)(d.phaselessTypes,{dragenter:!0,dragleave:!0,dropactivate:!0,dropdeactivate:!0,dropmove:!0,drop:!0}),d.methodDict.drop="dropzone",e.dynamicDrop=!1,l.actions.drop=h.defaults},listeners:{"interactions:before-action-start"({interaction:e}){"drag"===e.prepared.name&&(e.dropState={cur:{dropzone:null,element:null},prev:{dropzone:null,element:null},rejected:null,events:null,activeDrops:[]})},"interactions:after-action-start"({interaction:e,event:t,iEvent:r},o){if("drag"!==e.prepared.name)return;const n=e.dropState;n.activeDrops=[],n.events={},n.activeDrops=u(o,e.element),n.events=f(e,0,r),n.events.activate&&(s(n.activeDrops,n.events.activate),o.fire("actions/drop:start",{interaction:e,dragEvent:r}))},"interactions:action-move":g,"interactions:after-action-move"({interaction:e,iEvent:t},r){if("drag"!==e.prepared.name)return;const o=e.dropState;m(e,o.events),r.fire("actions/drop:move",{interaction:e,dragEvent:t}),o.events={}},"interactions:action-end"(e,t){if("drag"!==e.interaction.prepared.name)return;const{interaction:r,iEvent:o}=e;g(e,t),m(r,r.dropState.events),t.fire("actions/drop:end",{interaction:r,dragEvent:o})},"interactions:stop"({interaction:e}){if("drag"!==e.prepared.name)return;const{dropState:t}=e;t&&(t.activeDrops=null,t.events=null,t.cur.dropzone=null,t.cur.element=null,t.prev.dropzone=null,t.prev.element=null,t.rejected=!1)}},getActiveDrops:u,getDrop:v,getDropEvents:f,fireDropEvents:m,filterEventType:e=>0===e.search("drag")||0===e.search("drop"),defaults:{enabled:!1,accept:null,overlap:"pointer"}};exports.default=h;
//# sourceMappingURL=plugin.prod.js.map